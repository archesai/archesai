// Code generated by archesai. DO NOT EDIT.

package schemas

import (
	"context"
	"fmt"
	"time"

	"github.com/archesai/archesai/pkg/events"
	"github.com/google/uuid"
)

var (
	// ErrOrganizationNotFound is returned when a Organization entity is not found.
	ErrOrganizationNotFound = fmt.Errorf("organization not found")
)

// OrganizationPlan represents the enumeration of valid values for Plan
type OrganizationPlan string

// Valid Plan values
const (
	OrganizationPlanFREE      OrganizationPlan = "FREE"
	OrganizationPlanBASIC     OrganizationPlan = "BASIC"
	OrganizationPlanSTANDARD  OrganizationPlan = "STANDARD"
	OrganizationPlanPREMIUM   OrganizationPlan = "PREMIUM"
	OrganizationPlanUNLIMITED OrganizationPlan = "UNLIMITED"
)

// String returns the string representation
func (e OrganizationPlan) String() string {
	return string(e)
}

// IsValid checks if the value is valid
func (e OrganizationPlan) IsValid() bool {
	switch e {
	case OrganizationPlanFREE:
		return true
	case OrganizationPlanBASIC:
		return true
	case OrganizationPlanSTANDARD:
		return true
	case OrganizationPlanPREMIUM:
		return true
	case OrganizationPlanUNLIMITED:
		return true
	default:
		return false
	}
}

// ParseOrganizationPlan parses a string into the enum type
func ParseOrganizationPlan(s string) (OrganizationPlan, error) {
	v := OrganizationPlan(s)
	if !v.IsValid() {
		return "", fmt.Errorf("invalid Plan: %s", s)
	}
	return v, nil
}

// Organization represents Schema for Organization entity
type Organization struct {

	// ID Unique identifier for the resource
	ID uuid.UUID `json:"id" yaml:"id"`

	// CreatedAt The date and time when the resource was created
	CreatedAt time.Time `json:"createdAt" yaml:"createdAt"`

	// UpdatedAt The date and time when the resource was last updated
	UpdatedAt time.Time `json:"updatedAt" yaml:"updatedAt"`

	// BillingEmail Email address for billing communications
	BillingEmail *string `json:"billingEmail" yaml:"billingEmail"`

	// Credits Available credits for this organization
	Credits int32 `json:"credits" yaml:"credits"`

	// Logo The organization's logo URL
	Logo *string `json:"logo" yaml:"logo"`

	// Name The organization's display name
	Name string `json:"name" yaml:"name"`

	// Plan The current subscription plan
	Plan OrganizationPlan `json:"plan" yaml:"plan"`

	// Slug URL-friendly unique identifier for the organization
	Slug string `json:"slug" yaml:"slug"`

	// StripeCustomerIdentifier Stripe customer identifier
	StripeCustomerIdentifier string `json:"stripeCustomerIdentifier" yaml:"stripeCustomerIdentifier"`

	events []events.Event `json:"-" yaml:"-"`
}

// NewOrganization creates a new Organization entity.
// All required fields must be provided and valid.
func NewOrganization(
	billingEmail *string,
	credits int32,
	logo *string,
	name string,
	plan OrganizationPlan,
	slug string,
	stripeCustomerIdentifier string,
) (*Organization, error) {
	// Validate required fields
	if name == "" {
		return nil, fmt.Errorf("Name cannot be empty")
	}
	if !plan.IsValid() {
		return nil, fmt.Errorf("invalid Plan: %s", plan)
	}
	if slug == "" {
		return nil, fmt.Errorf("Slug cannot be empty")
	}
	if stripeCustomerIdentifier == "" {
		return nil, fmt.Errorf("StripeCustomerIdentifier cannot be empty")
	}
	now := time.Now().UTC()
	id := uuid.New()
	organization := &Organization{
		ID:                       id,
		CreatedAt:                now,
		UpdatedAt:                now,
		BillingEmail:             billingEmail,
		Credits:                  credits,
		Logo:                     logo,
		Name:                     name,
		Plan:                     plan,
		Slug:                     slug,
		StripeCustomerIdentifier: stripeCustomerIdentifier,
		events:                   []events.Event{},
	}
	organization.addEvent(NewOrganizationCreatedEvent(id))

	return organization, nil
}

// ZeroOrganization returns the zero value for Organization.
// This is useful for comparisons and as a default value.
func ZeroOrganization() Organization {
	return Organization{}
}

// GetID returns the ID
func (e *Organization) GetID() uuid.UUID {
	return e.ID
}

// GetCreatedAt returns the CreatedAt
func (e *Organization) GetCreatedAt() time.Time {
	return e.CreatedAt
}

// GetUpdatedAt returns the UpdatedAt
func (e *Organization) GetUpdatedAt() time.Time {
	return e.UpdatedAt
}

// GetBillingEmail returns the BillingEmail
func (e *Organization) GetBillingEmail() *string {
	return e.BillingEmail
}

// GetCredits returns the Credits
func (e *Organization) GetCredits() int32 {
	return e.Credits
}

// GetLogo returns the Logo
func (e *Organization) GetLogo() *string {
	return e.Logo
}

// GetName returns the Name
func (e *Organization) GetName() string {
	return e.Name
}

// GetPlan returns the Plan
func (e *Organization) GetPlan() OrganizationPlan {
	return e.Plan
}

// GetSlug returns the Slug
func (e *Organization) GetSlug() string {
	return e.Slug
}

// GetStripeCustomerIdentifier returns the StripeCustomerIdentifier
func (e *Organization) GetStripeCustomerIdentifier() string {
	return e.StripeCustomerIdentifier
}

// Events returns the domain events
func (e *Organization) Events() []events.Event {
	return e.events
}

// ClearEvents clears the domain events
func (e *Organization) ClearEvents() {
	e.events = []events.Event{}
}

// addEvent adds a domain event
func (e *Organization) addEvent(event events.Event) {
	e.events = append(e.events, event)
}

// Event type constants for Organization.
const (
	EventOrganizationCreated = "organization.created"
	EventOrganizationUpdated = "organization.updated"
	EventOrganizationDeleted = "organization.deleted"
)

// OrganizationCreatedEvent represents a created event for Organization.
type OrganizationCreatedEvent struct {
	events.BaseEvent
	OrganizationID uuid.UUID `json:"organization_id"`
}

// NewOrganizationCreatedEvent creates a new Organization created event.
func NewOrganizationCreatedEvent(id uuid.UUID) *OrganizationCreatedEvent {
	return &OrganizationCreatedEvent{
		BaseEvent:      events.NewBaseEvent("organization", EventOrganizationCreated),
		OrganizationID: id,
	}
}

// EventType returns the type of this event.
func (e *OrganizationCreatedEvent) EventType() string {
	return EventOrganizationCreated
}

// EventData returns the event data.
func (e *OrganizationCreatedEvent) EventData() any {
	return e
}

// OrganizationUpdatedEvent represents an updated event for Organization.
type OrganizationUpdatedEvent struct {
	events.BaseEvent
	OrganizationID uuid.UUID `json:"organization_id"`
}

// NewOrganizationUpdatedEvent creates a new Organization updated event.
func NewOrganizationUpdatedEvent(id uuid.UUID) *OrganizationUpdatedEvent {
	return &OrganizationUpdatedEvent{
		BaseEvent:      events.NewBaseEvent("organization", EventOrganizationUpdated),
		OrganizationID: id,
	}
}

// EventType returns the type of this event.
func (e *OrganizationUpdatedEvent) EventType() string {
	return EventOrganizationUpdated
}

// EventData returns the event data.
func (e *OrganizationUpdatedEvent) EventData() any {
	return e
}

// OrganizationDeletedEvent represents a deleted event for Organization.
type OrganizationDeletedEvent struct {
	events.BaseEvent
	OrganizationID uuid.UUID `json:"organization_id"`
}

// NewOrganizationDeletedEvent creates a new Organization deleted event.
func NewOrganizationDeletedEvent(id uuid.UUID) *OrganizationDeletedEvent {
	return &OrganizationDeletedEvent{
		BaseEvent:      events.NewBaseEvent("organization", EventOrganizationDeleted),
		OrganizationID: id,
	}
}

// EventType returns the type of this event.
func (e *OrganizationDeletedEvent) EventType() string {
	return EventOrganizationDeleted
}

// EventData returns the event data.
func (e *OrganizationDeletedEvent) EventData() any {
	return e
}

// OrganizationRepository handles organization persistence
type OrganizationRepository interface {
	// Basic CRUD operations (always included)
	Create(ctx context.Context, entity *Organization) (*Organization, error)
	Get(ctx context.Context, id uuid.UUID) (*Organization, error)
	Update(ctx context.Context, id uuid.UUID, entity *Organization) (*Organization, error)
	Delete(ctx context.Context, id uuid.UUID) error
	List(ctx context.Context, limit, offset int32) ([]*Organization, int64, error)

	// GetOrganizationBySlug retrieves a single organization by slug
	GetOrganizationBySlug(ctx context.Context, slug string) (*Organization, error)

	// GetOrganizationByStripeCustomerID retrieves a single organization by stripeCustomerIdentifier
	GetOrganizationByStripeCustomerID(ctx context.Context, stripeCustomerIdentifier string) (*Organization, error)
}
