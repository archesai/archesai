x-codegen-schema-type: entity
x-codegen:
  repository:
    excludeFromUpdate:
      - IPAddress
      - UserID
      - UserAgent
      - Token
    relations:
      - field: userID
        references: user
        onDelete: CASCADE
        onUpdate: NO_ACTION
    indices:
      - userID
      - token
description: Schema for Session entity
title: Session
x-internal: auth
allOf:
  - $ref: ./Base.yaml
  - type: object
    properties:
      organizationID:
        description:
          The organization ID for this session (nullable for users without
          org)
        oneOf:
          - type: string
            format: uuid
            minLength: 36
            maxLength: 36
          - type: 'null'
        example: 550e8400-e29b-41d4-a716-446655440000
      authMethod:
        description:
          The authentication method used (magic_link, oauth_google, oauth_github,
          etc.)
        oneOf:
          - type: string
            minLength: 1
            maxLength: 100
            pattern: ^[a-z_]+$
          - type: 'null'
        example: magic_link
      authProvider:
        description: The authentication provider (google, github, microsoft, local)
        type: [string, 'null']
        enum:
          - local
          - google
          - github
          - microsoft
          - apple
        example: local
      expiresAt:
        description: The expiration date of the session
        type: string
        minLength: 1
        format: date-time
        example: '2023-10-05T14:48:00Z'
        maxLength: 255
      ipAddress:
        description: The IP address of the session
        oneOf:
          - type: string
            format: ipv4
            minLength: 7
            maxLength: 45
          - type: 'null'
        example: 192.168.1.1
      token:
        description: The session token
        type: string
        minLength: 1
        example: eyJhbGciOiJIUzI1NiIs...
        maxLength: 512
        pattern: ^[A-Za-z0-9_\-\.]+$
      userAgent:
        description: The user agent of the session
        oneOf:
          - type: string
            minLength: 1
            maxLength: 255
            pattern: ^[\w\s\-.,!?()@#+/\(\):;]+$
          - type: 'null'
        example: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
      userID:
        description: The user who owns this session
        type: string
        format: uuid
        example: 550e8400-e29b-41d4-a716-446655440000
        minLength: 36
        maxLength: 36
    required:
      - expiresAt
      - token
      - userID
      - organizationID
      - authMethod
      - authProvider
      - ipAddress
      - userAgent
unevaluatedProperties: false
example:
  id: 550e8400-e29b-41d4-a716-446655440000
  createdAt: '2023-10-05T14:48:00Z'
  updatedAt: '2023-10-05T14:48:00Z'
  organizationID: 550e8400-e29b-41d4-a716-446655440000
  authMethod: magic_link
  authProvider: local
  expiresAt: '2023-10-05T14:48:00Z'
  ipAddress:
