# yaml-language-server: $schema=https://json-schema.org/draft/2020-12/schema
description: Schema for Session entity
x-codegen:
  # yaml-language-server: $schema=./XCodegen.yaml
  repository:
    operations: [create, read, update, delete, list]
    indices: [userID, token]
    additional_methods:
      - name: GetByToken
        params: [token]
        returns: single
      - name: DeleteByToken
        params: [token]
        returns: void
      - name: DeleteByUser
        params: [userID]
        returns: void
      - name: DeleteExpired
        params: []
        returns: void
  cache:
    enabled: true
    ttl: 120 # 2 minutes - shorter for sessions
    key_pattern: 'session:{token}'
    invalidate_on: [update, delete]
  events:
    - created
    - refreshed
    - expired
    - deleted
allOf:
  - $ref: ./Base.yaml
  - type: object
    properties:
      activeOrganizationID:
        allOf:
          - $ref: ./UUID.yaml
      expiresAt:
        description: The expiration date of the session
        type: string
        minLength: 1
        example: example-string
      ipAddress:
        description: The IP address of the session
        type: string
        example: example-string
        minLength: 1
      token:
        description: The session token
        type: string
        minLength: 1
        example: example-string
      userAgent:
        description: The user agent of the session
        type: string
        example: example-string
        minLength: 1
      userID:
        allOf:
          - $ref: ./UUID.yaml
    required:
      - activeOrganizationID
      - expiresAt
      - ipAddress
      - token
      - userAgent
      - userID
    additionalProperties: false
