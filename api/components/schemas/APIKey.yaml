x-codegen:
  schemaType: entity
  repository:
    operations:
      - create
      - update
      - delete
      - read
      - list
    excludeFromCreate:
      - CreatedAt
      - UpdatedAt
      - LastUsedAt
    excludeFromUpdate:
      - CreatedAt
      - UpdatedAt
      - UserID
      - OrganizationID
      - KeyHash
      - Prefix
      - LastUsedAt
    relations:
      - field: organizationID
        references: organization
        onDelete: CASCADE
        onUpdate: NO_ACTION
      - field: userID
        references: user
        onDelete: CASCADE
        onUpdate: NO_ACTION
    indices:
      - organizationID
      - userID
      - keyHash
      - lastUsedAt
title: APIKey
description: Schema for API Key entity
allOf:
  - $ref: ./Base.yaml
  - type: object
    properties:
      userID:
        description: The user who owns this API key
        type: string
        format: uuid
        example: 550e8400-e29b-41d4-a716-446655440000
        minLength: 36
        maxLength: 36
      organizationID:
        description: The organization this API key belongs to
        type: string
        format: uuid
        example: 550e8400-e29b-41d4-a716-446655440000
        minLength: 36
        maxLength: 36
      keyHash:
        type: string
        minLength: 1
        example: hashedskliveabc123
        description: Hashed version of the API key for secure storage
        maxLength: 255
        pattern: ^[a-zA-Z0-9]+$
      name:
        type: [string, 'null']
        minLength: 1
        example: Production API Key
        maxLength: 255
        pattern: ^[\w\s\-.,!?()@#+/']+$
      prefix:
        type: [string, 'null']
        minLength: 1
        example: sklive
        maxLength: 255
        pattern: ^[a-z]+$
      scopes:
        type: array
        items:
          type: string
          maxLength: 255
          pattern: ^[a-z]+:[a-z]+$
        example:
          - read:users
          - write:workflows
        maxItems: 1000
        default: []
      rateLimit:
        type: integer
        format: int32
        minimum: 1
        maximum: 2147483647
        example: 1000
        default: 60
        description: Requests per minute allowed for this API key
      lastUsedAt:
        type: [string, 'null']
        format: date-time
        minLength: 1
        example: '2024-01-15T09:30:00Z'
        description: When this API key was last used
        maxLength: 255
      expiresAt:
        type: [string, 'null']
        format: date-time
        minLength: 1
        example: '2025-01-15T09:30:00Z'
        description: When this API key expires
        maxLength: 255
    required:
      - scopes
      - rateLimit
      - keyHash
      - organizationID
      - userID
      - name
      - prefix
      - lastUsedAt
      - expiresAt
unevaluatedProperties: false
