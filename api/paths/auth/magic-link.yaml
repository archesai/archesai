# yaml-language-server: $schema=https://json-schema.org/draft/2020-12/schema
/auth/magic-links/request:
  post:
    operationId: requestMagicLink
    summary: Request a magic link
    description: Request a magic link to be sent via email or generate an OTP code
    tags:
      - Auth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              identifier:
                description: Email address or username
                type: string
                minLength: 1
                example: 'user@example.com'
              deliveryMethod:
                description: How to deliver the magic link
                type: string
                enum:
                  - email
                  - console
                  - otp
                  - webhook
                default: email
                example: email
              redirectUrl:
                description: URL to redirect to after successful authentication
                type: string
                format: uri
                example: 'https://app.archesai.com/dashboard'
            required:
              - identifier
    responses:
      '200':
        description: Magic link requested successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 'Magic link sent to user@example.com'
                otpCode:
                  description: OTP code (only returned if deliveryMethod is 'otp')
                  type: string
                  minLength: 6
                  maxLength: 6
                  example: '123456'
                expiresIn:
                  description: Token expiry in seconds
                  type: integer
                  example: 900
      '400':
        $ref: '../../components/responses/BadRequest.yaml'
      '429':
        $ref: '../../components/responses/TooManyRequests.yaml'
      '500':
        $ref: '../../components/responses/InternalServerError.yaml'

/auth/magic-links/verify:
  post:
    operationId: verifyMagicLink
    summary: Verify a magic link token
    description: Verify a magic link token or OTP code and create a session
    tags:
      - Auth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              token:
                description: Magic link token from URL
                type: string
                minLength: 32
                example: 'abc123def456789ghi012jkl345mno678pqr901stu234'
              code:
                description: OTP code (alternative to token)
                type: string
                minLength: 6
                maxLength: 6
                pattern: '^[0-9]{6}$'
                example: '123456'
              identifier:
                description: Required when using OTP code
                type: string
                example: 'user@example.com'
    responses:
      '201':
        description: Successfully authenticated
        content:
          application/json:
            schema:
              type: object
              properties:
                accessToken:
                  description: JWT access token
                  type: string
                  example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
                refreshToken:
                  description: JWT refresh token
                  type: string
                  example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
                tokenType:
                  description: Token type
                  type: string
                  example: 'Bearer'
                expiresIn:
                  description: Access token expiry in seconds
                  type: integer
                  example: 3600
                user:
                  $ref: '../../components/schemas/User.yaml'
      '400':
        $ref: '../../components/responses/BadRequest.yaml'
      '401':
        $ref: '../../components/responses/Unauthorized.yaml'
      '404':
        $ref: '../../components/responses/NotFound.yaml'
      '500':
        $ref: '../../components/responses/InternalServerError.yaml'
