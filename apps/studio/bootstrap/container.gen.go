// Code generated by archesai. DO NOT EDIT.

package bootstrap

import (
	postgresrepos "github.com/archesai/archesai/apps/studio/infrastructure/postgres/repositories"
	sqliterepos "github.com/archesai/archesai/apps/studio/infrastructure/sqlite/repositories"
	authbootstrap "github.com/archesai/archesai/pkg/auth/gen/bootstrap"
	configbootstrap "github.com/archesai/archesai/pkg/config/gen/bootstrap"
	"github.com/archesai/archesai/pkg/database"
	"github.com/archesai/archesai/pkg/events"
	executorbootstrap "github.com/archesai/archesai/pkg/executor/gen/bootstrap"
	pipelinesbootstrap "github.com/archesai/archesai/pkg/pipelines/gen/bootstrap"
	serverbootstrap "github.com/archesai/archesai/pkg/server/gen/bootstrap"
	storagebootstrap "github.com/archesai/archesai/pkg/storage/gen/bootstrap"
)

// Services holds shared dependencies for all handlers.
type Services struct {
	DB        *database.Database
	Publisher events.Publisher
}

// NewHandlers creates all handlers with the given services.
// This wires up all internal package dependencies using the infrastructure layer.
func NewHandlers(services *Services) *Handlers {
	db := services.DB.SQLDB()

	if services.DB.IsSQLite() {
		return &Handlers{
			Auth: authbootstrap.NewHTTPHandlers(authbootstrap.NewApplicationHandlers(
				sqliterepos.NewSQLiteAPIKeyRepository(db),
				sqliterepos.NewSQLiteAccountRepository(db),
				sqliterepos.NewSQLiteInvitationRepository(db),
				sqliterepos.NewSQLiteMemberRepository(db),
				sqliterepos.NewSQLiteOrganizationRepository(db),
				sqliterepos.NewSQLiteSessionRepository(db),
				sqliterepos.NewSQLiteUserRepository(db),
				services.Publisher,
			)),
			Config: configbootstrap.NewHTTPHandlers(configbootstrap.NewApplicationHandlers()),
			Executor: executorbootstrap.NewHTTPHandlers(executorbootstrap.NewApplicationHandlers(
				sqliterepos.NewSQLiteExecutorRepository(db),
				services.Publisher,
			)),
			Pipelines: pipelinesbootstrap.NewHTTPHandlers(pipelinesbootstrap.NewApplicationHandlers(
				sqliterepos.NewSQLitePipelineRepository(db),
				sqliterepos.NewSQLiteRunRepository(db),
				sqliterepos.NewSQLiteToolRepository(db),
				services.Publisher,
			)),
			Server: serverbootstrap.NewHTTPHandlers(serverbootstrap.NewApplicationHandlers()),
			Storage: storagebootstrap.NewHTTPHandlers(storagebootstrap.NewApplicationHandlers(
				sqliterepos.NewSQLiteArtifactRepository(db),
				sqliterepos.NewSQLiteLabelRepository(db),
				services.Publisher,
			)),
		}
	}

	// PostgreSQL
	pool := services.DB.PgxPool()
	return &Handlers{
		Auth: authbootstrap.NewHTTPHandlers(authbootstrap.NewApplicationHandlers(
			postgresrepos.NewPostgresAPIKeyRepository(pool),
			postgresrepos.NewPostgresAccountRepository(pool),
			postgresrepos.NewPostgresInvitationRepository(pool),
			postgresrepos.NewPostgresMemberRepository(pool),
			postgresrepos.NewPostgresOrganizationRepository(pool),
			postgresrepos.NewPostgresSessionRepository(pool),
			postgresrepos.NewPostgresUserRepository(pool),
			services.Publisher,
		)),
		Config: configbootstrap.NewHTTPHandlers(configbootstrap.NewApplicationHandlers()),
		Executor: executorbootstrap.NewHTTPHandlers(executorbootstrap.NewApplicationHandlers(
			postgresrepos.NewPostgresExecutorRepository(pool),
			services.Publisher,
		)),
		Pipelines: pipelinesbootstrap.NewHTTPHandlers(pipelinesbootstrap.NewApplicationHandlers(
			postgresrepos.NewPostgresPipelineRepository(pool),
			postgresrepos.NewPostgresRunRepository(pool),
			postgresrepos.NewPostgresToolRepository(pool),
			services.Publisher,
		)),
		Server: serverbootstrap.NewHTTPHandlers(serverbootstrap.NewApplicationHandlers()),
		Storage: storagebootstrap.NewHTTPHandlers(storagebootstrap.NewApplicationHandlers(
			postgresrepos.NewPostgresArtifactRepository(pool),
			postgresrepos.NewPostgresLabelRepository(pool),
			services.Publisher,
		)),
	}
}
