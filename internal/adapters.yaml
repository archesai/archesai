# Adapter configuration for generating type mappings between layers
adapters:
  # Auth domain adapters
  - name: AuthUserDBToAPI
    from: postgresql.User
    to: domain.UserEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      Email: "openapi_types.Email(from.Email)"
      Name: "from.Name" # Not nullable in DB

  - name: AuthSessionDBToAPI
    from: postgresql.Session
    to: domain.SessionEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      UserId: "from.UserId" # API expects string, not UUID
      ExpiresAt: "from.ExpiresAt.Format(time.RFC3339)"
      ActiveOrganizationId: "handleNullableString(from.ActiveOrganizationId)"

  - name: AuthAccountDBToAPI
    from: postgresql.Account
    to: domain.AccountEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      AccountId: "from.AccountId" # API expects string
      UserId: "uuid.MustParse(from.UserId)" # API expects UUID
      ProviderId: "domain.AccountEntityProviderId(from.ProviderId)"
      IdToken: "handleNullableString(from.IdToken)"
      Password: "handleNullableString(from.Password)"
      AccessTokenExpiresAt: "handleNullableTimestamp(from.AccessTokenExpiresAt)"
      RefreshTokenExpiresAt: "handleNullableTimestamp(from.RefreshTokenExpiresAt)"

  # Organizations domain adapters
  - name: OrganizationDBToAPI
    from: postgresql.Organization
    to: domain.OrganizationEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      Plan: "domain.OrganizationEntityPlan(from.Plan)"
      BillingEmail: "openapi_types.Email(handleNullableString(from.BillingEmail))"
      Credits: "float32(from.Credits)"
      Metadata: "handleNullableMetadata(from.Metadata)"
      Name: "from.Name" # Not nullable in DB
      StripeCustomerId: "handleNullableString(from.StripeCustomerId)" # Already a pointer

  # Workflows domain adapters
  - name: PipelineDBToAPI
    from: postgresql.Pipeline
    to: domain.PipelineEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      OrganizationId: "uuid.MustParse(from.OrganizationId)"

  - name: RunDBToAPI
    from: postgresql.Run
    to: domain.RunEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      PipelineId: "handleNullableString(from.PipelineId)"
      OrganizationId: "from.OrganizationId"
      ToolId: "from.ToolId"
      Status: "domain.RunEntityStatus(from.Status)"
      Progress: "float32(from.Progress)"

  - name: ToolDBToAPI
    from: postgresql.Tool
    to: domain.ToolEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      OrganizationId: "from.OrganizationId"
      Description: "from.Description"
      Name: "from.Name" # Not nullable in DB

  - name: MemberDBToAPI
    from: postgresql.Member
    to: domain.MemberEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      UserId: "from.UserId" # API expects string, not UUID
      OrganizationId: "from.OrganizationId" # API expects string, not UUID
      Role: "domain.MemberEntityRole(from.Role)" # Use correct type

  - name: InvitationDBToAPI
    from: postgresql.Invitation
    to: domain.InvitationEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      OrganizationId: "from.OrganizationId" # API expects string, not UUID
      InviterId: "from.InviterId" # API expects string, not UUID
      Email: "from.Email" # API expects string, not Email type
      Role: "domain.InvitationEntityRole(from.Role)" # Use correct type
      ExpiresAt: "from.ExpiresAt.Format(time.RFC3339)" # Format as string

  # Content domain adapters
  - name: ArtifactDBToAPI
    from: postgresql.Artifact
    to: domain.ArtifactEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      Credits: "float32(from.Credits)"
      OrganizationId: "from.OrganizationId"
      ProducerId: "handleNullableString(from.ProducerId)"

  - name: LabelDBToAPI
    from: postgresql.Label
    to: domain.LabelEntity
    automap: true
    overrides:
      Id: "uuid.MustParse(from.Id)"
      OrganizationId: "from.OrganizationId"
      Name: "from.Name"
