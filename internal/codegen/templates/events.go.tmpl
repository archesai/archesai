// Code generated by codegen events. DO NOT EDIT.
package {{.Package}}

import (
	"context"
	"github.com/archesai/archesai/internal/events"
)

// Event type constants for {{.Domain}} domain.
const (
{{range $entity := .Entities}}{{if $entity.XCodegen}}{{range $event := $entity.XCodegen.Events}}	Event{{$entity.Name}}{{title $event}} = "{{lower $entity.Name}}.{{kebabCase $event}}"
{{end}}{{end}}{{end}})

{{range $entity := .Entities}}{{if $entity.XCodegen}}{{range $event := $entity.XCodegen.Events}}
// {{$entity.Name}}{{title $event}}Event represents a {{$event}} event for {{$entity.Name}}.
type {{$entity.Name}}{{title $event}}Event struct {
	events.BaseEvent
	{{$entity.Name}} *{{$entity.Name}} `json:"{{lower $entity.Name}}"`
}

// New{{$entity.Name}}{{title $event}}Event creates a new {{$entity.Name}} {{$event}} event.
func New{{$entity.Name}}{{title $event}}Event(entity *{{$entity.Name}}) *{{$entity.Name}}{{title $event}}Event {
	return &{{$entity.Name}}{{title $event}}Event{
		BaseEvent: events.NewBaseEvent("{{lower $.Domain}}", Event{{$entity.Name}}{{title $event}}),
		{{$entity.Name}}: entity,
	}
}

// EventType returns the event type string.
func (e *{{$entity.Name}}{{title $event}}Event) EventType() string {
	return Event{{$entity.Name}}{{title $event}}
}

// EventDomain returns the domain this event belongs to.
func (e *{{$entity.Name}}{{title $event}}Event) EventDomain() string {
	return "{{lower $.Domain}}"
}

// EventData returns the actual event data.
func (e *{{$entity.Name}}{{title $event}}Event) EventData() interface{} {
	return e.{{$entity.Name}}
}
{{end}}{{end}}{{end}}

// EventPublisher publishes domain events for {{.Domain}}.
type EventPublisher interface {
{{range $entity := .Entities}}{{if $entity.XCodegen}}{{range $event := $entity.XCodegen.Events}}	Publish{{$entity.Name}}{{title $event}}(ctx context.Context, entity *{{$entity.Name}}) error
{{end}}{{end}}{{end}}}

// eventPublisher implements EventPublisher for {{.Domain}} domain.
type eventPublisher struct {
	publisher events.Publisher
}

// NewEventPublisher creates a new event publisher for {{.Domain}} domain.
func NewEventPublisher(publisher events.Publisher) EventPublisher {
	return &eventPublisher{
		publisher: publisher,
	}
}

{{range $entity := .Entities}}{{if $entity.XCodegen}}{{range $event := $entity.XCodegen.Events}}
// Publish{{$entity.Name}}{{title $event}} publishes a {{$event}} event for {{$entity.Name}}.
func (p *eventPublisher) Publish{{$entity.Name}}{{title $event}}(ctx context.Context, entity *{{$entity.Name}}) error {
	event := New{{$entity.Name}}{{title $event}}Event(entity)
	return events.PublishDomainEvent(ctx, p.publisher, event)
}
{{end}}{{end}}{{end}}

// NewNoOpEventPublisher creates a new no-op event publisher for testing.
func NewNoOpEventPublisher() EventPublisher {
	return NewEventPublisher(events.NewNoOpPublisher())
}