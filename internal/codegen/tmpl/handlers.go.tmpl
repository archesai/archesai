{{- /*
Template: handlers.go.tmpl
Generates: ApplicationHandlers struct with proper dependency injection.
Expects:
- Operations: []OperationDef
- Repositories: []string (unique repository names)
- ProjectName: string
- NeedsPublisher: bool (true if any non-GET, non-custom operations exist)
*/ -}}
{{template "header" .}}
package bootstrap

import (
	"{{ .ProjectName }}/application"
{{- if .Repositories }}
	"{{ .ProjectName }}/repositories"
{{- end }}
{{- if .NeedsPublisher }}
	"github.com/archesai/archesai/pkg/events"
{{- end }}
)

// ApplicationHandlers holds all application-layer handlers for this package.
type ApplicationHandlers struct {
{{- range .Operations }}
	{{ .ID }} application.{{ .ID }}Handler
{{- end }}
}

// NewApplicationHandlers creates all application handlers with proper dependency injection.
func NewApplicationHandlers(
{{- range .Repositories }}
	{{ camelCase . }}Repo repositories.{{ . }}Repository,
{{- end }}
{{- if .NeedsPublisher }}
	publisher events.Publisher,
{{- end }}
) *ApplicationHandlers {
	return &ApplicationHandlers{
{{- range .Operations }}
{{- if .XCodegenCustomHandler }}
		{{ .ID }}: application.New{{ .ID }}Handler(),
{{- else if eq .Method "GET" }}
		{{ .ID }}: application.New{{ .ID }}Handler({{ camelCase (or .XCodegenRepository .Tag) }}Repo),
{{- else }}
		{{ .ID }}: application.New{{ .ID }}Handler({{ camelCase (or .XCodegenRepository .Tag) }}Repo, publisher),
{{- end }}
{{- end }}
	}
}
