{{- /*
Template: routes.go.tmpl
Generates: Route registration and HTTP handlers for a package
Expects:
- Operations: []Operation (for internal packages)
- InternalPackages: []InternalPackage (for composition apps)
- ProjectName: string
*/ -}}
{{template "header" .}}
package bootstrap

{{- if .InternalPackages }}
import (
	"net/http"
{{- range .InternalPackages }}
	{{ .Alias }}bootstrap "{{ .ImportPath }}/bootstrap"
{{- end }}
)

// Handlers composes all handlers from internal packages.
type Handlers struct {
{{- range .InternalPackages }}
	{{ pascalCase .Name }} *{{ .Alias }}bootstrap.HTTPHandlers
{{- end }}
}

// RegisterRoutes registers all routes from all internal packages.
func RegisterRoutes(mux *http.ServeMux, handlers *Handlers) {
{{- range .InternalPackages }}
	{{ .Alias }}bootstrap.RegisterRoutes(mux, handlers.{{ pascalCase .Name }})
{{- end }}
}
{{- else }}
import (
	"log/slog"
	"net/http"

	"{{ .ProjectName }}/controllers"
)

// HTTPHandlers holds all HTTP handlers for this package.
type HTTPHandlers struct {
{{- range .Operations }}
	{{ .ID }} *controllers.{{ .ID }}Handler
{{- end }}
}

// NewHTTPHandlers creates all HTTP handlers from the given application handlers.
func NewHTTPHandlers(appHandlers *ApplicationHandlers) *HTTPHandlers {
	return &HTTPHandlers{
{{- range .Operations }}
		{{ .ID }}: controllers.New{{ .ID }}Handler(appHandlers.{{ .ID }}),
{{- end }}
	}
}

// RegisterRoutes registers all routes for this package with the http.ServeMux.
func RegisterRoutes(mux *http.ServeMux, handlers *HTTPHandlers) {
{{- range .Operations }}
	slog.Info("registering route", "method", "{{ .Method }}", "path", "{{ .Path }}")
	controllers.Register{{ .ID }}Route(mux, handlers.{{ .ID }})
{{- end }}
}
{{- end }}
