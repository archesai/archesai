apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ./api
  - ./nlp
  - ./upgrade

images:
  - name: us-east4-docker.pkg.dev/archesai/images/arches-api
    newName: us-east4-docker.pkg.dev/archesai/images/arches-api
    newTag: latest
  - name: us-east4-docker.pkg.dev/archesai/images/arches-ui
    newName: us-east4-docker.pkg.dev/archesai/images/arches-ui
    newTag: latest
  - name: us-east4-docker.pkg.dev/archesai/images/arches-nlp
    newName: us-east4-docker.pkg.dev/archesai/images/arches-nlp
    newTag: latest

replacements:
  - source:
      kind: Job
      fieldPath: metadata.name
    targets:
      - select:
          kind: Deployment
          name: arches-api
        fieldPaths:
          - spec.template.spec.initContainers.0.args.1
      - select:
          kind: Role
          name: arches-api-role
        fieldPaths:
          - rules.0.resourceNames.0
