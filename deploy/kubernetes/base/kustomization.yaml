apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ./api
  - ./unstructured
  - ./playwright

images:
  - name: us-east4-docker.pkg.dev/archesai/images/arches-api
    newName: us-east4-docker.pkg.dev/archesai/images/arches-api
    newTag: latest
  - name: us-east4-docker.pkg.dev/archesai/images/arches-ui
    newName: us-east4-docker.pkg.dev/archesai/images/arches-ui
    newTag: latest

# replacements:
#   - source:
#       kind: Job
#       fieldPath: metadata.name
#     targets:
#       - select:
#           kind: Deployment
#           name: arches-api
#         fieldPaths:
#           - spec.template.spec.initContainers.0.args.1
#       - select:
#           kind: Role
#           name: arches-api-role
#         fieldPaths:
#           - rules.0.resourceNames.0

secretGenerator:
  - name: arches-api-config-secret
    literals:
      # GLOBAL CONFIG
      - NODE_ENV=development
      - SERVER_HOST=https://arches-api.test
      - FRONTEND_HOST=https://arches-ui.test
      - PORT=3001
      - ALLOWED_ORIGINS=*

      # DATABASE CONFIG
      - DATABASE_URL=postgresql://admin:admin@arches-postgres:5432/nestjs?schema=public

      # EMAIL CONFIG
      - FEATURE_EMAIL=false

      # EMBEDDING CONFIG
      - EMBEDDING_TYPE=openai

      # JWT CONFIG
      - JWT_API_TOKEN_EXPIRATION_TIME=31536000
      - JWT_API_TOKEN_SECRET=asdfasdf

      # BILLING CONFIG
      - FEATURE_BILLING=false

      # LLM CONFIG
      - LLM_TYPE=openai
      - LLM_API_KEY=open-ai-key

      # STORAGE CONFIG
      - STORAGE_TYPE=minio
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_BUCKET=archesai
      - MINIO_ENDPOINT=https://arches-minio.test
      - MINIO_DASHBOARD_ENDPOINT=https://dashboard.arches-minio.test
      - MINIO_SECRET_KEY=minioadmin

      # REDIS CONFIG
      - REDIS_AUTH=PASSWORD
      - REDIS_HOST=arches-redis
      - REDIS_PORT=6379

      # SESSION CONFIG
      - SESSION_SECRET=secret

      # LOGGING CONFIG
      - LOGGING_LEVEL=debug

      # SCRAPER CONFIG
      - FEATURE_SCRAPER=true
      - SCRAPER_ENDPOINT=http://arches-playwright:3000

      # UNSTRUCTURED CONFIG
      - FEATURE_UNSTRUCTURED=true
      - UNSTRUCTURED_ENDPOINT=http://arches-unstructured:8000

generatorOptions:
  disableNameSuffixHash: true
