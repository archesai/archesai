apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

resources:
  - archesai-tls-issuer.yaml

patches:
  - target:
      name: archesai-ingress
    patch: |-
      - op: replace
        path: /spec/tls
        value:
          - hosts:
              - '*.mydomain'
            secretName: archesai-tls
      - op: add
        path: /metadata/annotations
        value:
          cert-manager.io/issuer: letsencrypt-staging
          cert-manager.io/private-key-algorithm: ECDSA
  - target:
      name: archesai-config-secret
    patch: |-
      - op: add
        path: /stringData/ARCHES.TLS.ENABLED
        value: 'true'
