apiVersion: batch/v1
kind: Job
metadata:
  name: arches-api-upgrade
spec:
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        - name: arches-api-upgrade
          image: arches-api:dev
          imagePullPolicy: IfNotPresent
          args:
            - |
              npm install && npx prisma migrate deploy --schema /app/prisma/schema.prisma
      securityContext:
        runAsUser: 0
        runAsGroup: 0
  backoffLimit: 6
