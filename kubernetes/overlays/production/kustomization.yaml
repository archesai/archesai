apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
bases:
  - "../../base"
namespace: archesai

images:
  - name: us-east4-docker.pkg.dev/archesai/images/arches-api
    newName: us-east4-docker.pkg.dev/archesai/images/arches-api
    newTag: cce2e35
  - name: us-east4-docker.pkg.dev/archesai/images/arches-ui
    newName: us-east4-docker.pkg.dev/archesai/images/arches-ui
    newTag: 75f7815
  - name: us-east4-docker.pkg.dev/archesai/images/arches-nlp
    newName: us-east4-docker.pkg.dev/archesai/images/arches-nlp
    newTag: 0c0943d

secretGenerator:
  - name: arches-api-config-secret
    envs:
      - ./.env.production
    behavior: replace
  - name: arches-redis-ca-cert
    files:
      - "redis-ca.pem"

patches:
  - path: "./arches-api-deployment.yaml"
    target:
      kind: Deployment
      name: arches-api

resources:
  - "./cloud-service-account.yaml"
  - "./arches-api-managedcertificate.yaml"
  - "./arches-api-ingress.yaml"
