apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base
  - stripe-webhook-proxy.yaml

components:
  - ../../components/database
  - ../../components/redis
  - ../../components/storage
  - ../../components/ui
  - ../../components/scraper
  - ../../components/unstructured
  - ../../components/tls

secretGenerator:
  - name: archesai-config-volume
    behavior: merge
    files:
      - z-development-config.yaml
  - name: archesai-tls
    type: kubernetes.io/tls
    files:
      - tls.crt=./certs/fullchain.pem
      - tls.key=./certs/privkey.pem

configMapGenerator:
  - name: archesai-config-ingress
    behavior: merge
    literals:
      - ARCHES_DOMAIN=archesai.dev
    options:
      disableNameSuffixHash: true

patches:
  - target:
      kind: Job
      name: migrations
    patch: |
      - op: replace
        path: /spec/template/spec/restartPolicy
        value: OnFailure
      - op: add
        path: /spec/ttlSecondsAfterFinished
        value: 10
