// Code generated by archesai. DO NOT EDIT.

package bootstrap

import (
	authbootstrap "github.com/archesai/archesai/pkg/auth/gen/bootstrap"
	"github.com/archesai/archesai/pkg/database"
	"github.com/archesai/archesai/pkg/events"
	serverbootstrap "github.com/archesai/archesai/pkg/server/gen/bootstrap"
	postgresrepos "github.com/archesai/examples/authentication/infrastructure/postgres/repositories"
	sqliterepos "github.com/archesai/examples/authentication/infrastructure/sqlite/repositories"
)

// Services holds shared dependencies for all handlers.
type Services struct {
	DB        *database.Database
	Publisher events.Publisher
}

// NewHandlers creates all handlers with the given services.
// This wires up all internal package dependencies using the infrastructure layer.
func NewHandlers(services *Services) *Handlers {
	db := services.DB.SQLDB()

	if services.DB.IsSQLite() {
		return &Handlers{
			Auth: authbootstrap.NewHTTPHandlers(authbootstrap.NewApplicationHandlers(
				sqliterepos.NewSQLiteAPIKeyRepository(db),
				sqliterepos.NewSQLiteAccountRepository(db),
				sqliterepos.NewSQLiteInvitationRepository(db),
				sqliterepos.NewSQLiteMemberRepository(db),
				sqliterepos.NewSQLiteOrganizationRepository(db),
				sqliterepos.NewSQLiteSessionRepository(db),
				sqliterepos.NewSQLiteUserRepository(db),
				services.Publisher,
			)),
			Server: serverbootstrap.NewHTTPHandlers(serverbootstrap.NewApplicationHandlers()),
		}
	}

	// PostgreSQL
	pool := services.DB.PgxPool()
	return &Handlers{
		Auth: authbootstrap.NewHTTPHandlers(authbootstrap.NewApplicationHandlers(
			postgresrepos.NewPostgresAPIKeyRepository(pool),
			postgresrepos.NewPostgresAccountRepository(pool),
			postgresrepos.NewPostgresInvitationRepository(pool),
			postgresrepos.NewPostgresMemberRepository(pool),
			postgresrepos.NewPostgresOrganizationRepository(pool),
			postgresrepos.NewPostgresSessionRepository(pool),
			postgresrepos.NewPostgresUserRepository(pool),
			services.Publisher,
		)),
		Server: serverbootstrap.NewHTTPHandlers(serverbootstrap.NewApplicationHandlers()),
	}
}
